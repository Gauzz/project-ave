<?phprequire '../includes/functions.php';$token="TST".mt_rand(111111,999999);if(isset($_POST["testimonial"])){$description=mysqli_real_escape_string($conn,$_POST["description"]);$title=mysqli_real_escape_string($conn,$_POST["title"]);$post=mysqli_real_escape_string($conn,$_POST["post"]);$image=$_FILES['image']['name'];$tmp_name=$_FILES['image']['tmp_name'];$tkimage=$token.$image;move_uploaded_file($tmp_name,"uploads/testimonials/".$tkimage);if (strlen($description) < 150) {if(!empty($image)){$query=mysqli_query($conn,"INSERT INTO testimonials(image,description,name,position,token)VALUES('$tkimage','$description','$title','$post','$token')");}else{$query=mysqli_query($conn,"INSERT INTO testimonials(image,description,name,position,token)VALUES('defaultTest.png','$description','$title','$post','$token')");}if($query){  exit(json_encode(["response"=>["code"=>"1","msg"=>"User testimonial added successfully"]]));}else{exit(json_encode(["response"=>["code"=>"00","msg"=>"Error in uploading testimonials"]]));}}else{exit(json_encode(["response"=>["code"=>"00","msg"=>"Max Characters Is 150 For Description!"]]));}}/* Delete Testimonial*/if (isset($_POST["deleteTestimonial"])) {$id=$_POST["deleteTestimonial"];$querygetdelete=mysqli_query($conn,"DELETE FROM testimonials WHERE id=$id");if ($querygetdelete) {exit(json_encode(array("response" => array("code" => "1" ,"msg" => "Testimonials deleted Successfully"))));}else{exit(json_encode(array("response" => array("code" => "0" ,"msg" => "Something Went Wrong! Please try Again Later"))));}}/* Change Status */if (isset($_POST["changeStatus"])) {$id=$_POST["changeStatus"];$queryGetStatus=mysqli_query($conn,"SELECT * FROM testimonials WHERE id='$id'");$GetStatus=mysqli_fetch_array($queryGetStatus);if ($GetStatus["status"]=="0") {$status='1';}if ($GetStatus["status"]=='1') {$status='0';}$queryForStatusChange=mysqli_query($conn,"UPDATE testimonials SET status='$status' WHERE id='$id'");if ($queryForStatusChange) {exit(json_encode(["response" => ["code" => "1","status" => $status]]));}else{exit(json_encode(["response" => ["code" => "0","status" => $status]]));}}secureAdmin();?><!DOCTYPE html><html lang="en">  <head>    <?php include 'partials/_style.php'; ?>  </head>  <!-- END HEAD -->  <body class="page-header-fixed sidemenu-closed-hidelogo page-content-white page-md header-white dark-sidebar-color logo-dark">    <div class="page-wrapper">      <!-- start header -->      <?php include 'partials/_header.php'; ?>      <!-- end header -->      <!-- start page container -->      <div class="page-container">        <!-- start sidebar menu -->        <?php include 'partials/_sidebar.php'; ?>        <!-- end sidebar menu -->        <!-- start page content -->        <div class="page-content-wrapper">          <div class="page-content tre">            <div class="page-bar">              <div class="page-title-breadcrumb">                <div class=" pull-left">                  <div class="page-title">Add Testimonials</div>                </div>                <ol class="breadcrumb page-breadcrumb pull-right">                  <li><i class="fa fa-home"></i>&nbsp;<a class="parent-item" href="index.php">Home</a>&nbsp;<i class="fa fa-angle-right"></i>                </li>                <li><a class="parent-item" href="#">Testimonials</a>&nbsp;<i class="fa fa-angle-right"></i>              </li>              <li class="active">Add Testimonials</li>            </ol>          </div>        </div>        <div class="row">          <div class="col-sm-12">            <div class="card-box">              <div class="card-head">              <header>User Testimonials Information</header>            </div>            <form method="POST" id="addingTestimonial" enctype="multipart/form-data">              <div class="card-body row">                <div class="col-lg-12 p-t-20">                  <img onclick="opendialog()" style="cursor: pointer;" id="img_pre" src="https://www.chaarat.com/wp-content/uploads/2017/08/placeholder-user.png" height="100px" width="100px" border="1">                  <label onclick="opendialog()" style="cursor: pointer;" class="control-label col-md-3">Upload Testimonial User Image</label>                  <input id="imagebox" onchange="document.getElementById('img_pre').src = window.URL.createObjectURL(this.files[0])" style="display: none;"  type="file" class="form-control" name="image">                  <input type="hidden" name="testimonial" value="true">                </div>                <div class="col-lg-12 p-t-20">                  <div class="mdl-textfield mdl-js-textfield txt-full-width">                    <textarea name="description" class="mdl-textfield__input" rows="2" id = "text7" ></textarea>                    <label class="mdl-textfield__label" for="text7">Description (Max. Characters 150)</label>                  </div>                </div>                <div class="col-lg-6 p-t-20">                  <div class = "mdl-textfield mdl-js-textfield mdl-textfield--floating-label txt-full-width">                    <input required=""  onkeypress="validateName_onKeyPress_space(event)" class="mdl-textfield__input" name="title" type= "text">                    <label class = "mdl-textfield__label">Name</label>                  </div>                </div>                <div class="col-lg-6 p-t-20">                  <div class = "mdl-textfield mdl-js-textfield mdl-textfield--floating-label txt-full-width">                    <input name="post" value="user" class = "mdl-textfield__input" type="text" required="">                    <label class = "mdl-textfield__label">Position</label>                  </div>                </div>                <div class="col-lg-12 p-t-20 text-center">                  <button type="submit" id="" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect m-b-10 m-r-20 btn-pink">Submit</button>                  <button type="button" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect m-b-10 btn-default">Cancel</button>                </div>              </div>            </form>          </div>        </div>      </div>      <div class="row">        <div class="col-md-12">          <div class="card card-topline-aqua">            <div class="card-head">            <header>View User Testimonials Information</header>          </div>          <div class="card-body ">            <div class="table-scrollable">              <table id="example1" class="display full-width">                <thead>                  <tr>                    <th>#</th>                    <th>Description</th>                    <th>Name</th>                    <th>Position</th>                    <th>Created At</th>                    <th>Status</th>                    <th width="20%">Action</th>                  </tr>                </thead>                <tbody>                  <?php                  $queryFetchUsers=mysqli_query($conn,"SELECT * FROM testimonials ORDER BY created_at DESC");                  while ($fetchTestimonials=mysqli_fetch_array($queryFetchUsers)) {                  ?>                  <tr class="row<?= $fetchTestimonials["id"];?>">                    <td class="user-circle-img">                      <img height="50px" width="50px" src="uploads/testimonials/<?php echo $fetchTestimonials["image"] ?>" alt="">                    </td>                    <td><?php echo $fetchTestimonials["description"] ?></td>                    <td><?php echo $fetchTestimonials["name"]; ?></td>                    <td><?php echo $fetchTestimonials["position"]; ?></td>                    <td><?php echo dateFormat($fetchTestimonials["created_at"],"d/m/Y"); ?></td>                    <td>                      <button id="status<?= $fetchTestimonials["id"] ?>" type="button" data-id="<?= $fetchTestimonials["id"] ?>" class="btn btn-circle <?php echo ($fetchTestimonials["status"]=='1')? "btn-success" : "btn-danger" ; ?> status"><?php echo ($fetchTestimonials["status"]=='1')? "Active" : "Deactive" ; ?></button>                    </td>                    <td>                      <button class="btn dark btn-outline btn-circle delete-testimonial" data-id="<?= $fetchTestimonials["id"] ?>" aria-pressed="true">                      <i class="fa fa-trash"></i>                      </button>                    </td>                  </tr>                  <?php } ?>                </tbody>              </table>            </div>          </div>        </div>      </div>    </div>  </div></div></div><!-- end page container --><!-- start footer --><?php include 'partials/_footer.php'; ?><!-- end footer --></div><?php include 'partials/_script.php'; ?><script type="text/javascript">function image(img) {var src = img.src;window.open(src);  }$("#addingTestimonial").trigger('reset');</script><script type="text/javascript">$("#img_pre").click(function() {  $("#userImage").click();});$("#addingTestimonial").trigger('reset');</script><script type="text/javascript">/*delete testimonial admin*/$(".delete-testimonial").click(function() {$(this).html("<i class='fa fa-ellipsis-h'></i>");var id=$(this).data("id");swal({title: "Are you sure?",text: "This will delete From Database And You'll Not be Able to recover it",icon: "warning",buttons: true,dangerMode: true,}).then((willDelete) => {if (willDelete) {$.ajax({url: 'add-testimonial.php',type: 'POST',dataType:'json',data: {deleteTestimonial: id},}).always(function(data) {console.log(data.response.msg);$(".row"+id).fadeOut('slow');$(this).html("<i class='fa fa-trash' ></i>");});}else {swal("Your Testimonial is Safe!");$(this).html("<i class='fa fa-trash'></i>");}});});/*add testimonial admin*/  function opendialog() {  $("#imagebox").trigger('click');  }  $(document).ready(function (e) {  $('#addingTestimonial').on('submit',(function(e) {  e.preventDefault();  var formData = new FormData(this);  $.ajax({  type:'POST',  url: 'add-testimonial.php',  data:formData,  cache:false,  dataType:'json',  contentType: false,  processData: false,  success:function(data){  if (data.response.code=='1') {$("#addingTestimonial").trigger('reset');swal("success",data.response.msg,"success");  // swal("Success",data.response.msg,"success");setTimeout(function(){window.location="add-testimonial.php";}, 1000);  }  if (data.response.code=='00') {  swal("Oh Snap",data.response.msg,"warning");  }  },  error: function(data){  console.log("error");  console.log(data);  }  });  }));  });$(".status").click(function() {var id=$(this).data("id");$.ajax({url: 'add-testimonial.php',type: 'POST',dataType: 'json',data: {changeStatus: id},}).done(function(data) {if (data.response.code=='1') {if (data.response.status=='1') {$("#status"+id).removeClass('btn-danger');$("#status"+id).addClass('btn-success');$("#status"+id).html("Active");}if (data.response.status=='0') {$("#status"+id).removeClass('btn-success');$("#status"+id).addClass('btn-danger');$("#status"+id).html("Deactive");}}if (data.response.code=='0') {swal("oh Snap","Something Went Wrong Please Contact Developers!","error");}}).fail(function() {swal("oh Snap","Something Went Wrong Please Contact Developers!","error");}).always(function(data) {console.log(data);});});</script></body></html>